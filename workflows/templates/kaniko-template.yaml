apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: kaniko-build-template
  namespace: argo
spec:
  templates:
  - name: kaniko-build
    inputs:
      parameters:
        - name: repo
        - name: dockerfile
          value: Dockerfile
        - name: destination
    container:
      image: gcr.io/kaniko-project/executor:latest
      command:
        - /kaniko/executor
      args:
        - --dockerfile=/workspace/{{inputs.parameters.dockerfile}}
        - --context={{inputs.parameters.repo}}
        - --destination={{inputs.parameters.destination}}
        - --cache=true
      volumeMounts:
        - name: kaniko-secret
          mountPath: /kaniko/.docker
  volumes:
    - name: kaniko-secret
      secret:
        secretName: regcred

